#!/bin/bash

make transmute_trees

if [[ $# -lt 3 ]]; then
    echo -e "usage: ./tt [total entries] [arguments to transmute_trees, excluding entry range]\n"
    ./transmute_trees
    exit 1
fi

PARTS=20
ENTRIES=$1
SPLIT=$(( ($ENTRIES + $PARTS - 1) / $PARTS ))

for PART in $(seq 0 $(( $PARTS - 1 )) ); do
    BASE=$(basename $2 .root)
    ./transmute_trees $2 ${3}.$PART $(( $PART * $SPLIT )) $(( ($PART + 1) * $SPLIT )) ${@:4} &> notes/log-tt-$BASE-$1-${PART}.log &
done

wait
hadd $3 ${3}.*
